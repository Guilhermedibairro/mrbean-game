<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Mr. Bean Game - Ranking Online</title>
  <style>
    body {
      margin: 0;
      background: #d0e7f9;
      overflow: hidden;
      font-family: Arial, sans-serif;
      user-select: none;
    }
    #menu, #ranking, #game {
      width: 400px;
      margin: 20px auto;
      background: #88b3e0;
      border: 3px solid #444;
      border-radius: 10px;
      padding: 20px;
      box-sizing: border-box;
      color: #333;
      text-align: center;
    }
    #menu input {
      display: block;
      width: 90%;
      margin: 10px auto;
      padding: 10px;
      font-size: 18px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    #menu button, #ranking button, #gameover button {
      margin-top: 15px;
      padding: 8px 16px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background: #4caf50;
      color: white;
      transition: background 0.3s ease;
    }
    #menu button:hover, #ranking button:hover, #gameover button:hover {
      background: #388e3c;
    }
    #game {
      position: relative;
      height: 600px;
      overflow: hidden;
      padding: 0;
    }
    #mrbean {
      position: absolute;
      bottom: 10px;
      width: 80px;
      height: 80px;
      left: 160px;
      background: url('https://c1.klipartz.com/pngpicture/463/833/sticker-png-mr-bean-cartoon-television-television-show-drawing-animation-humour-cartoon-network-thumbnail.png') no-repeat center/contain;
      z-index: 2;
    }
    .objeto {
      position: absolute;
      width: 60px; /* menor que antes */
      height: 60px;
      background: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ7rbm5sTL-PJahmpAhpEyvZ5yZek8z-FvRZhcrfb0iTpC70J_002Deviuq2T-Jgd4fqWQ&usqp=CAU') no-repeat center/contain;
      top: -60px;
      left: 0;
      z-index: 1;
    }
    #cat-image {
      position: absolute;
      bottom: 10px;
      left: 160px;
      width: 80px;
      height: 80px;
      background: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRwepJH990FRSX9v9UvQpOwuizunCI3As02AQ&s') no-repeat center/contain;
      display: none;
      z-index: 3;
    }
    #gameover {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.95);
      padding: 30px;
      border-radius: 10px;
      font-size: 24px;
      display: none;
      border: 2px solid #444;
      width: 80%;
      text-align: center;
      z-index: 5;
      user-select: none;
    }
    #gameover img {
      width: 200px;
      margin-bottom: 15px;
      border-radius: 10px;
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
    }
    #scoreboard {
      text-align: center;
      margin: 10px auto;
      font-size: 20px;
      color: #333;
      user-select: none;
      max-width: 400px;
    }
    #ranking ul {
      list-style: none;
      padding: 0;
      max-height: 300px;
      overflow-y: auto;
      margin: 10px 0;
      color: #000;
      text-align: left;
    }
    #ranking li {
      background: #b2d1f2;
      margin: 5px 0;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 18px;
    }
  </style>
</head>
<body>

  <div id="menu">
    <h1>üéÆ Mr. Bean Game</h1>
    <input type="text" id="playerName" placeholder="Seu nome" />
    <input type="email" id="playerEmail" placeholder="Seu email" />
    <button onclick="startGame()">Jogar</button>
    <button onclick="showRanking()">Ver Ranking Online</button>
  </div>

  <div id="ranking" style="display:none;">
    <h2>üèÜ Ranking Global</h2>
    <ul id="rankingList"></ul>
    <button onclick="backToMenu()">Voltar</button>
  </div>

  <div id="game" style="display:none;">
    <div id="mrbean"></div>
    <div id="cat-image"></div>
    <div id="gameover">
      <img src="https://i.pinimg.com/236x/65/bc/95/65bc95e680feb2a428483191e2be2fb8.jpg" alt="Mr Bean assustado com Mrs. Wicked" />
      <div id="finalscore"></div>
      <button onclick="restartGame()">Reiniciar</button>
      <button onclick="saveScoreAndShowRanking()">Ver Ranking</button>
      <button onclick="backToMenu()">Menu</button>
    </div>
  </div>

  <div id="scoreboard" style="display:none;">Pontua√ß√£o: 0 | Vidas: 3 | N√≠vel: 1</div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // *** COLOQUE AQUI SEU firebaseConfig DO SEU PROJETO FIREBASE ***
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_AUTH_DOMAIN",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_STORAGE_BUCKET",
      messagingSenderId: "SEU_MESSAGING_SENDER_ID",
      appId: "SEU_APP_ID"
    };

    // Inicializa Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const menu = document.getElementById('menu');
    const rankingDiv = document.getElementById('ranking');
    const game = document.getElementById('game');
    const mrbean = document.getElementById('mrbean');
    const catImage = document.getElementById('cat-image');
    const scoreboard = document.getElementById('scoreboard');
    const gameoverScreen = document.getElementById('gameover');
    const finalscore = document.getElementById('finalscore');
    const rankingList = document.getElementById('rankingList');

    const gameWidth = 400;
    const gameHeight = 600;
    const mrbeanWidth = 80;
    const mrbeanHeight = 80;

    let mrbeanX = 160;
    const mrbeanY = gameHeight - mrbeanHeight - 10;
    let speed = 14;
    let objetos = [];
    let spawnInterval;
    let gameLoopInterval;

    let score = 0;
    let lives = 3;
    let level = 1;
    let isGameOver = false;

    let player = {
      name: '',
      email: ''
    };

    function createObjeto() {
      const objeto = document.createElement('div');
      objeto.classList.add('objeto');
      objeto.style.left = Math.floor(Math.random() * (gameWidth - 60)) + 'px';
      objeto.style.top = '-60px';
      game.appendChild(objeto);

      const fallSpeed = 3 + Math.random() * 2 + (level - 1) * 1.5;

      objetos.push({
        element: objeto,
        y: -60,
        x: parseInt(objeto.style.left),
        speed: fallSpeed,
      });
    }

    function moveMrBean(direction) {
      if (direction === 'left') {
        mrbeanX -= speed;
        if (mrbeanX < 0) mrbeanX = 0;
      } else if (direction === 'right') {
        mrbeanX += speed;
        if (mrbeanX > gameWidth - mrbeanWidth) mrbeanX = gameWidth - mrbeanWidth;
      }
      mrbean.style.left = mrbeanX + 'px';
      catImage.style.left = mrbeanX + 'px';
    }

    function checkCollision(obj) {
      const objX = obj.x;
      const objY = obj.y;
      const objWidth = 60;
      const objHeight = 60;

      if (
        objX < mrbeanX + mrbeanWidth &&
        objX + objWidth > mrbeanX &&
        objY + objHeight > mrbeanY &&
        objY < mrbeanY + mrbeanHeight
      ) {
        return true;
      }
      return false;
    }

    function updateLevel() {
      const newLevel = Math.floor(score / 10) + 1;
      if (newLevel !== level) {
        level = newLevel;
        updateScoreboard();

        clearInterval(spawnInterval);
        const newSpawnTime = Math.max(700, 1500 - (level - 1) * 200);
        spawnInterval = setInterval(() => {
          if (!isGameOver) createObjeto();
        }, newSpawnTime);
      }
    }

    function updateScoreboard() {
      scoreboard.textContent = `Pontua√ß√£o: ${score} | Vidas: ${lives} | N√≠vel: ${level}`;
    }

    function update() {
      if (isGameOver) return;

      objetos.forEach((obj, index) => {
        obj.y += obj.speed;
        obj.element.style.top = obj.y + 'px';

        if (checkCollision(obj)) {
          score++;
          updateLevel();
          updateScoreboard();
          game.removeChild(obj.element);
          objetos.splice(index, 1);
        } else if (obj.y > gameHeight) {
          game.removeChild(obj.element);
          objetos.splice(index, 1);
          lives--;
          updateScoreboard();
          if (lives <= 0) endGame();
        }
      });
    }

    function endGame() {
      isGameOver = true;
      catImage.style.display = 'none';

      // Define a imagem do game over conforme pontua√ß√£o
      let imgSrc = '';
      if (score < 10) {
        imgSrc = 'https://i.pinimg.com/236x/65/bc/95/65bc95e680feb2a428483191e2be2fb8.jpg';
      } else if (score >= 11 && score <= 20) {
        imgSrc = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSHf_0KFs9sb3e2Jg8mO5i1y_7WL7cHVwjaNw&s';
      } else if (score >= 21 && score <= 30) {
        imgSrc = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSgMxnlwlrSBW2EAEtnmFC-mXCHgrdPXtGZOw&s';
      } else if (score > 30) {
        imgSrc = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTld38MlyngO1MOuf6rVYTP0U_sZhmfxYcCRQ&s';
      }

      const imgElement = gameoverScreen.querySelector('img');
      imgElement.src = imgSrc;

      gameoverScreen.style.display = 'block';
      finalscore.textContent = `Game Over! Sua pontua√ß√£o: ${score}`;
    }

    function restartGame() {
      objetos.forEach(obj => game.removeChild(obj.element));
      objetos = [];
      score = 0;
      lives = 3;
      level = 1;
      isGameOver = false;
      mrbeanX = 160;
      mrbean.style.left = mrbeanX + 'px';
      catImage.style.left = mrbeanX + 'px';
      catImage.style.display = 'none';
      updateScoreboard();
      gameoverScreen.style.display = 'none';

      clearInterval(spawnInterval);
      spawnInterval = setInterval(() => {
        if (!isGameOver) createObjeto();
      }, 1500);

      clearInterval(gameLoopInterval);
      gameLoopInterval = setInterval(update, 30);
    }

    function startGame() {
      const nameInput = document.getElementById('playerName');
      const emailInput = document.getElementById('playerEmail');

      if (nameInput.value.trim() === '' || emailInput.value.trim() === '') {
        alert('Por favor, insira seu nome e email para jogar.');
        return;
      }

      player.name = nameInput.value.trim();
      player.email = emailInput.value.trim();

      menu.style.display = 'none';
      rankingDiv.style.display = 'none';
      game.style.display = 'block';
      scoreboard.style.display = 'block';

      restartGame();
    }

    // Salvar o score no Firestore
    async function saveScore() {
      if (!player.name || !player.email) return;

      try {
        await db.collection('rankings').add({
          name: player.name,
          email: player.email,
          score: score,
          date: new Date()
        });
        // console.log('Score salvo!');
      } catch (error) {
        console.error('Erro ao salvar score:', error);
      }
    }

    // Mostrar ranking online
    async function showRanking() {
      menu.style.display = 'none';
      game.style.display = 'none';
      scoreboard.style.display = 'none';
      gameoverScreen.style.display = 'none';
      rankingDiv.style.display = 'block';

      rankingList.innerHTML = '<li>Carregando...</li>';

      try {
        const querySnapshot = await db.collection('rankings')
          .orderBy('score', 'desc')
          .limit(20)
          .get();

        rankingList.innerHTML = '';

        querySnapshot.forEach((doc) => {
          const data = doc.data();
          const li = document.createElement('li');
          li.textContent = `${data.name} - ${data.score} pts`;
          rankingList.appendChild(li);
        });

        if (rankingList.children.length === 0) {
          rankingList.innerHTML = '<li>Nenhum dado dispon√≠vel.</li>';
        }

      } catch (error) {
        rankingList.innerHTML = '<li>Erro ao carregar ranking.</li>';
        console.error('Erro ao buscar ranking:', error);
      }
    }

    function backToMenu() {
      rankingDiv.style.display = 'none';
      game.style.display = 'none';
      scoreboard.style.display = 'none';
      gameoverScreen.style.display = 'none';
      menu.style.display = 'block';
    }

    async function saveScoreAndShowRanking() {
      await saveScore();
      showRanking();
    }

    // Controles simples de teclado para movimentar Mr. Bean
    document.addEventListener('keydown', (e) => {
      if (!game.style.display || game.style.display === 'none') return;
      if (isGameOver) return;

      if (e.key === 'ArrowLeft' || e.key === 'a') {
        moveMrBean('left');
      } else if (e.key === 'ArrowRight' || e.key === 'd') {
        moveMrBean('right');
      }
    });
  </script>
</body>
</html>




